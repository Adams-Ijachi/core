{"version":3,"sources":["webpack://@flarum/core/./src/forum/components/ChangeEmailModal.js"],"names":["ChangeEmailModal","oninit","vnode","this","success","email","Stream","app","session","user","password","className","title","translator","trans","content","onclick","hide","bind","type","name","placeholder","bidi","disabled","loading","Button","onsubmit","e","preventDefault","alertAttrs","save","errorHandler","onerror","meta","then","loaded","error","status","alert","Modal","window","flreg","add"],"mappings":"wKAQqBA,E,sGACnBC,OAAA,SAAOC,GACL,YAAMD,OAAN,UAAaC,GAObC,KAAKC,SAAU,EAOfD,KAAKE,OAAQC,OAAOC,IAAIC,QAAQC,KAAKJ,SAOrCF,KAAKO,UAAWJ,OAAO,K,EAGzBK,UAAA,WACE,MAAO,iC,EAGTC,MAAA,WACE,OAAOL,IAAIM,WAAWC,MAAM,kC,EAG9BC,QAAA,WACE,OAAIZ,KAAKC,QAEL,SAAKO,UAAU,cACb,SAAKA,UAAU,uBACb,OAAGA,UAAU,YACVJ,IAAIM,WAAWC,MAAM,+CAAgD,CAAET,MAAO,gBAASF,KAAKE,YAE/F,SAAKM,UAAU,cACb,EAAC,IAAD,CAAQA,UAAU,uCAAuCK,QAASb,KAAKc,KAAKC,KAAKf,OAC9EI,IAAIM,WAAWC,MAAM,8CAShC,SAAKH,UAAU,cACb,SAAKA,UAAU,uBACb,SAAKA,UAAU,cACb,WACEQ,KAAK,QACLC,KAAK,QACLT,UAAU,cACVU,YAAad,IAAIC,QAAQC,KAAKJ,QAC9BiB,KAAMnB,KAAKE,MACXkB,SAAUpB,KAAKqB,WAGnB,SAAKb,UAAU,cACb,WACEQ,KAAK,WACLC,KAAK,WACLT,UAAU,cACVU,YAAad,IAAIM,WAAWC,MAAM,wDAClCQ,KAAMnB,KAAKO,SACXa,SAAUpB,KAAKqB,WAGnB,SAAKb,UAAU,cACZc,cACC,CACEd,UAAW,uCACXQ,KAAM,SACNK,QAASrB,KAAKqB,SAEhBjB,IAAIM,WAAWC,MAAM,8C,EAQjCY,SAAA,SAASC,GAAG,WACVA,EAAEC,iBAIEzB,KAAKE,UAAYE,IAAIC,QAAQC,KAAKJ,SAKtCF,KAAKqB,SAAU,EACfrB,KAAK0B,WAAa,KAElBtB,IAAIC,QAAQC,KACTqB,KACC,CAAEzB,MAAOF,KAAKE,SACd,CACE0B,aAAc5B,KAAK6B,QAAQd,KAAKf,MAChC8B,KAAM,CAAEvB,SAAUP,KAAKO,cAG1BwB,MAAK,WACJ,EAAK9B,SAAU,KATnB,OAWS,eACN8B,KAAK/B,KAAKgC,OAAOjB,KAAKf,QAnBvBA,KAAKc,Q,EAsBTe,QAAA,SAAQI,GACe,MAAjBA,EAAMC,SACRD,EAAME,MAAMvB,QAAUR,IAAIM,WAAWC,MAAM,uDAG7C,YAAMkB,QAAN,UAAcI,I,GA3H4BG,KA+H9CC,OAAOC,MAAMC,IAAI,8BAA+B1C","file":"forum/components/ChangeEmailModal.js","sourcesContent":["import Modal from '../../common/components/Modal';\nimport Button from '../../common/components/Button';\nimport Stream from '../../common/utils/Stream';\n\n/**\n * The `ChangeEmailModal` component shows a modal dialog which allows the user\n * to change their email address.\n */\nexport default class ChangeEmailModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    /**\n     * Whether or not the email has been changed successfully.\n     *\n     * @type {Boolean}\n     */\n    this.success = false;\n\n    /**\n     * The value of the email input.\n     *\n     * @type {function}\n     */\n    this.email = Stream(app.session.user.email());\n\n    /**\n     * The value of the password input.\n     *\n     * @type {function}\n     */\n    this.password = Stream('');\n  }\n\n  className() {\n    return 'ChangeEmailModal Modal--small';\n  }\n\n  title() {\n    return app.translator.trans('core.forum.change_email.title');\n  }\n\n  content() {\n    if (this.success) {\n      return (\n        <div className=\"Modal-body\">\n          <div className=\"Form Form--centered\">\n            <p className=\"helpText\">\n              {app.translator.trans('core.forum.change_email.confirmation_message', { email: <strong>{this.email()}</strong> })}\n            </p>\n            <div className=\"Form-group\">\n              <Button className=\"Button Button--primary Button--block\" onclick={this.hide.bind(this)}>\n                {app.translator.trans('core.forum.change_email.dismiss_button')}\n              </Button>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"Modal-body\">\n        <div className=\"Form Form--centered\">\n          <div className=\"Form-group\">\n            <input\n              type=\"email\"\n              name=\"email\"\n              className=\"FormControl\"\n              placeholder={app.session.user.email()}\n              bidi={this.email}\n              disabled={this.loading}\n            />\n          </div>\n          <div className=\"Form-group\">\n            <input\n              type=\"password\"\n              name=\"password\"\n              className=\"FormControl\"\n              placeholder={app.translator.trans('core.forum.change_email.confirm_password_placeholder')}\n              bidi={this.password}\n              disabled={this.loading}\n            />\n          </div>\n          <div className=\"Form-group\">\n            {Button.component(\n              {\n                className: 'Button Button--primary Button--block',\n                type: 'submit',\n                loading: this.loading,\n              },\n              app.translator.trans('core.forum.change_email.submit_button')\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    // If the user hasn't actually entered a different email address, we don't\n    // need to do anything. Woot!\n    if (this.email() === app.session.user.email()) {\n      this.hide();\n      return;\n    }\n\n    this.loading = true;\n    this.alertAttrs = null;\n\n    app.session.user\n      .save(\n        { email: this.email() },\n        {\n          errorHandler: this.onerror.bind(this),\n          meta: { password: this.password() },\n        }\n      )\n      .then(() => {\n        this.success = true;\n      })\n      .catch(() => {})\n      .then(this.loaded.bind(this));\n  }\n\n  onerror(error) {\n    if (error.status === 401) {\n      error.alert.content = app.translator.trans('core.forum.change_email.incorrect_password_message');\n    }\n\n    super.onerror(error);\n  }\n}\n\nwindow.flreg.add('components/ChangeEmailModal', ChangeEmailModal)"],"sourceRoot":""}