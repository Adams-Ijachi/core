{"version":3,"sources":["webpack://@flarum/core/./src/forum/components/LogInModal.js"],"names":["LogInModal","oninit","vnode","this","identification","Stream","attrs","password","remember","className","title","app","translator","trans","content","body","footer","fields","toArray","items","ItemList","add","name","type","placeholder","extractText","bidi","disabled","loading","Button","onclick","forgotPassword","bind","forum","attribute","a","signUp","email","indexOf","undefined","modal","show","onready","$","select","onsubmit","e","preventDefault","session","login","errorHandler","onerror","then","window","location","reload","loaded","error","status","alert","Modal"],"mappings":"iNAeqBA,E,sGACnBC,OAAA,SAAOC,GACL,YAAMD,OAAN,UAAaC,GAObC,KAAKC,gBAAiBC,OAAOF,KAAKG,MAAMF,gBAAkB,IAO1DD,KAAKI,UAAWF,OAAOF,KAAKG,MAAMC,UAAY,IAO9CJ,KAAKK,UAAWH,SAASF,KAAKG,MAAME,W,EAGtCC,UAAA,WACE,MAAO,2B,EAGTC,MAAA,WACE,OAAOC,IAAIC,WAAWC,MAAM,4B,EAG9BC,QAAA,WACE,MAAO,CAAC,SAAKL,UAAU,cAAcN,KAAKY,QAAe,SAAKN,UAAU,gBAAgBN,KAAKa,Y,EAG/FD,KAAA,WACE,MAAO,CAAC,EAAC,IAAD,MAAkB,SAAKN,UAAU,uBAAuBN,KAAKc,SAASC,a,EAGhFD,OAAA,WACE,IAAME,EAAQ,IAAIC,IA4DlB,OA1DAD,EAAME,IACJ,iBACA,SAAKZ,UAAU,cACb,WACEA,UAAU,cACVa,KAAK,iBACLC,KAAK,OACLC,aAAaC,OAAYd,IAAIC,WAAWC,MAAM,oDAC9Ca,KAAMvB,KAAKC,eACXuB,SAAUxB,KAAKyB,WAGnB,IAGFT,EAAME,IACJ,WACA,SAAKZ,UAAU,cACb,WACEA,UAAU,cACVa,KAAK,WACLC,KAAK,WACLC,aAAaC,OAAYd,IAAIC,WAAWC,MAAM,2CAC9Ca,KAAMvB,KAAKI,SACXoB,SAAUxB,KAAKyB,WAGnB,IAGFT,EAAME,IACJ,WACA,SAAKZ,UAAU,cACb,aACE,WAAOA,UAAU,YACf,WAAOc,KAAK,WAAWG,KAAMvB,KAAKK,SAAUmB,SAAUxB,KAAKyB,UAC1DjB,IAAIC,WAAWC,MAAM,0CAI5B,IAGFM,EAAME,IACJ,SACA,SAAKZ,UAAU,cACZoB,cACC,CACEpB,UAAW,uCACXc,KAAM,SACNK,QAASzB,KAAKyB,SAEhBjB,IAAIC,WAAWC,MAAM,sCAGxB,IAGIM,G,EAGTH,OAAA,WACE,MAAO,CACL,OAAGP,UAAU,6BACX,OAAGqB,QAAS3B,KAAK4B,eAAeC,KAAK7B,OAAQQ,IAAIC,WAAWC,MAAM,4CAGpEF,IAAIsB,MAAMC,UAAU,eAClB,OAAGzB,UAAU,qBAAqBE,IAAIC,WAAWC,MAAM,iCAAkC,CAAEsB,EAAG,OAAGL,QAAS3B,KAAKiC,OAAOJ,KAAK7B,WAE3H,K,EAWN4B,eAAA,WACE,IAEMM,EAAQlC,KAAKC,iBACbE,GAAgC,IAAxB+B,EAAMC,QAAQ,KAAc,CAAED,cAAUE,EAEtD5B,IAAI6B,MAAMC,MALkB,kBAAM,gCAKEnC,I,EAStC8B,OAAA,WACE,IAEM9B,EAAQ,CAAEC,SAAUJ,KAAKI,YACzBH,EAAiBD,KAAKC,iBAC5BE,GAAuC,IAAjCF,EAAekC,QAAQ,KAAc,QAAU,YAAclC,EAEnEO,IAAI6B,MAAMC,MANU,kBAAM,gCAMEnC,I,EAG9BoC,QAAA,WACEvC,KAAKwC,EAAE,UAAYxC,KAAKC,iBAAmB,WAAa,kBAAoB,KAAKwC,U,EAGnFC,SAAA,SAASC,GACPA,EAAEC,iBAEF5C,KAAKyB,SAAU,EAEf,IAAMxB,EAAiBD,KAAKC,iBACtBG,EAAWJ,KAAKI,WAChBC,EAAWL,KAAKK,WAEtBG,IAAIqC,QACDC,MAAM,CAAE7C,iBAAgBG,WAAUC,YAAY,CAAE0C,aAAc/C,KAAKgD,QAAQnB,KAAK7B,QAChFiD,MAAK,kBAAMC,OAAOC,SAASC,WAAUpD,KAAKqD,OAAOxB,KAAK7B,Q,EAG3DgD,QAAA,SAAQM,GACe,MAAjBA,EAAMC,SACRD,EAAME,MAAM7C,QAAUH,IAAIC,WAAWC,MAAM,4CAG7C,YAAMsC,QAAN,UAAcM,I,GA9KsBG","file":"forum/components/LogInModal.js","sourcesContent":["import Modal from '../../common/components/Modal';\nimport Button from '../../common/components/Button';\nimport LogInButtons from './LogInButtons';\nimport extractText from '../../common/utils/extractText';\nimport ItemList from '../../common/utils/ItemList';\nimport Stream from '../../common/utils/Stream';\n\n/**\n * The `LogInModal` component displays a modal dialog with a login form.\n *\n * ### Attrs\n *\n * - `identification`\n * - `password`\n */\nexport default class LogInModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    /**\n     * The value of the identification input.\n     *\n     * @type {Function}\n     */\n    this.identification = Stream(this.attrs.identification || '');\n\n    /**\n     * The value of the password input.\n     *\n     * @type {Function}\n     */\n    this.password = Stream(this.attrs.password || '');\n\n    /**\n     * The value of the remember me input.\n     *\n     * @type {Function}\n     */\n    this.remember = Stream(!!this.attrs.remember);\n  }\n\n  className() {\n    return 'LogInModal Modal--small';\n  }\n\n  title() {\n    return app.translator.trans('core.forum.log_in.title');\n  }\n\n  content() {\n    return [<div className=\"Modal-body\">{this.body()}</div>, <div className=\"Modal-footer\">{this.footer()}</div>];\n  }\n\n  body() {\n    return [<LogInButtons />, <div className=\"Form Form--centered\">{this.fields().toArray()}</div>];\n  }\n\n  fields() {\n    const items = new ItemList();\n\n    items.add(\n      'identification',\n      <div className=\"Form-group\">\n        <input\n          className=\"FormControl\"\n          name=\"identification\"\n          type=\"text\"\n          placeholder={extractText(app.translator.trans('core.forum.log_in.username_or_email_placeholder'))}\n          bidi={this.identification}\n          disabled={this.loading}\n        />\n      </div>,\n      30\n    );\n\n    items.add(\n      'password',\n      <div className=\"Form-group\">\n        <input\n          className=\"FormControl\"\n          name=\"password\"\n          type=\"password\"\n          placeholder={extractText(app.translator.trans('core.forum.log_in.password_placeholder'))}\n          bidi={this.password}\n          disabled={this.loading}\n        />\n      </div>,\n      20\n    );\n\n    items.add(\n      'remember',\n      <div className=\"Form-group\">\n        <div>\n          <label className=\"checkbox\">\n            <input type=\"checkbox\" bidi={this.remember} disabled={this.loading} />\n            {app.translator.trans('core.forum.log_in.remember_me_label')}\n          </label>\n        </div>\n      </div>,\n      10\n    );\n\n    items.add(\n      'submit',\n      <div className=\"Form-group\">\n        {Button.component(\n          {\n            className: 'Button Button--primary Button--block',\n            type: 'submit',\n            loading: this.loading,\n          },\n          app.translator.trans('core.forum.log_in.submit_button')\n        )}\n      </div>,\n      -10\n    );\n\n    return items;\n  }\n\n  footer() {\n    return [\n      <p className=\"LogInModal-forgotPassword\">\n        <a onclick={this.forgotPassword.bind(this)}>{app.translator.trans('core.forum.log_in.forgot_password_link')}</a>\n      </p>,\n\n      app.forum.attribute('allowSignUp') ? (\n        <p className=\"LogInModal-signUp\">{app.translator.trans('core.forum.log_in.sign_up_text', { a: <a onclick={this.signUp.bind(this)} /> })}</p>\n      ) : (\n        ''\n      ),\n    ];\n  }\n\n  /**\n   * Open the forgot password modal, prefilling it with an email if the user has\n   * entered one.\n   *\n   * @public\n   */\n  forgotPassword() {\n    const ForgotPasswordModal = () => import(/* webpackChunkName: \"forum/components/ForgotPasswordModal\" */ './ForgotPasswordModal');\n\n    const email = this.identification();\n    const attrs = email.indexOf('@') !== -1 ? { email } : undefined;\n\n    app.modal.show(ForgotPasswordModal, attrs);\n  }\n\n  /**\n   * Open the sign up modal, prefilling it with an email/username/password if\n   * the user has entered one.\n   *\n   * @public\n   */\n  signUp() {\n    const SignUpModal = () => import(/* webpackChunkName: \"forum/components/SignUpModal\" */ './SignUpModal');\n\n    const attrs = { password: this.password() };\n    const identification = this.identification();\n    attrs[identification.indexOf('@') !== -1 ? 'email' : 'username'] = identification;\n\n    app.modal.show(SignUpModal, attrs);\n  }\n\n  onready() {\n    this.$('[name=' + (this.identification() ? 'password' : 'identification') + ']').select();\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    this.loading = true;\n\n    const identification = this.identification();\n    const password = this.password();\n    const remember = this.remember();\n\n    app.session\n      .login({ identification, password, remember }, { errorHandler: this.onerror.bind(this) })\n      .then(() => window.location.reload(), this.loaded.bind(this));\n  }\n\n  onerror(error) {\n    if (error.status === 401) {\n      error.alert.content = app.translator.trans('core.forum.log_in.invalid_login_message');\n    }\n\n    super.onerror(error);\n  }\n}\n"],"sourceRoot":""}