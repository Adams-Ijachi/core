(self.webpackChunk_flarum_core=self.webpackChunk_flarum_core||[]).push([[779],{4425:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>A});var a=r(1788),s=r(8931),n=r(8046),o=r(9052),i=r(4594),u=r(2587),l=r(5128),d=r(453),c=r(8726),p=r(9349),f=r(2558),h=r(7473),v=function(t){function e(){return t.apply(this,arguments)||this}(0,a.Z)(e,t);var r=e.prototype;return r.view=function(t){return t.children[0]},r.oncreate=function(e){t.prototype.oncreate.call(this,e),this.boundOnresize=this.onresize.bind(this),$(window).on("resize",this.boundOnresize).resize()},r.onremove=function(){$(window).off("resize",this.boundOnresize)},r.onresize=function(){var t=this,e=this.$(),r=$("#header"),a=$("#footer"),s=e.find("> ul");$(window).off(".affix"),s.removeClass("affix affix-top affix-bottom").removeData("bs.affix"),e.outerHeight(!0)>$(window).height()-r.outerHeight(!0)||s.affix({offset:{top:function(){return e.offset().top-r.outerHeight(!0)-parseInt(e.css("margin-top"),10)},bottom:function(){return t.bottom=a.outerHeight(!0)}}})},e}(s.Z);window.flreg.add("components/AffixedSidebar",v);var g=function(t){function e(){return t.apply(this,arguments)||this}(0,a.Z)(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.user=null,this.bodyClass="App--user"},r.view=function(){return m("div",{className:"UserPage"},this.user?[m(_,{user:this.user,className:"Hero UserHero",editable:this.user.canEdit()||this.user===app.session.user,controlsButtonClassName:"Button"}),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m(v,null,m("nav",{className:"sideNav UserPage-nav"},m("ul",null,(0,h.Z)(this.sidebarItems().toArray())))),m("div",{className:"sideNavOffset UserPage-content"},this.content())))]:[m(c.Z,{className:"LoadingIndicator--block"})])},r.content=function(){},r.show=function(t){this.user=t,app.current.set("user",t),app.setTitle(t.displayName()),m.redraw()},r.loadUser=function(t){var e=this,r=t.toLowerCase();app.preloadedApiDocument(),app.store.all("users").some((function(a){if((a.username().toLowerCase()===r||a.id()===t)&&a.joinTime())return e.show(a),!0})),this.user||app.store.find("users",t,{bySlug:!0}).then(this.show.bind(this))},r.sidebarItems=function(){var t=new i.Z;return t.add("nav",m(p.Z,{className:"App-titleControl",buttonClassName:"Button"},this.navItems().toArray())),t},r.navItems=function(){var t=new i.Z,e=this.user;return t.add("posts",m(f.Z,{href:app.route("user.posts",{username:e.username()}),icon:"far fa-comment"},app.translator.trans("core.forum.user.posts_link")," ",m("span",{className:"Button-badge"},e.commentCount())),100),t.add("discussions",m(f.Z,{href:app.route("user.discussions",{username:e.username()}),icon:"fas fa-bars"},app.translator.trans("core.forum.user.discussions_link")," ",m("span",{className:"Button-badge"},e.discussionCount())),90),app.session.user===e&&(t.add("separator",m(l.Z,null),-90),t.add("settings",m(f.Z,{href:app.route("settings"),icon:"fas fa-cog"},app.translator.trans("core.forum.user.settings_link")),-100)),t},e}(d.Z);window.flreg.add("components/UserPage",g);var b=function(){function t(){}var e=t.prototype;return e.controls=function(t,e){var r=this,a=new i.Z;return["user","moderation","destructive"].forEach((function(s){var n=r[s+"Controls"](t,e).toArray();n.length&&(n.forEach((function(t){return a.add(t.itemName,t)})),a.add(s+"Separator",m(l.Z,null)))})),a},e.userControls=function(){return new i.Z},e.moderationControls=function(t){var e=new i.Z;return(t.canEdit()||t.canEditCredentials()||t.canEditGroups())&&e.add("edit",m(u.Z,{icon:"fas fa-pencil-alt",onclick:this.editAction.bind(this,t)},app.translator.trans("core.forum.user_controls.edit_button"))),e},e.destructiveControls=function(t){var e=new i.Z;return"1"!==t.id()&&t.canDelete()&&e.add("delete",m(u.Z,{icon:"fas fa-times",onclick:this.deleteAction.bind(this,t)},app.translator.trans("core.forum.user_controls.delete_button"))),e},e.deleteAction=function(t){var e=this;confirm(app.translator.trans("core.forum.user_controls.delete_confirmation"))&&t.delete().then((function(){e.showDeletionAlert(t,"success"),app.current.matches(g,{user:t})?app.history.back():window.location.reload()})).catch((function(){return e.showDeletionAlert(t,"error")}))},e.showDeletionAlert=function(t,e){var r=t.data.attributes,a=r.username,s=r.email,n={success:"core.forum.user_controls.delete_success_message",error:"core.forum.user_controls.delete_error_message"}[e];app.alerts.show({type:e},app.translator.trans(n,{username:a,email:s}))},e.editAction=function(t){app.modal.show((function(){return r.e(352).then(r.bind(r,3089))}),{user:t})},t}();window.flreg.add("utils/UserControls",b);var w=r(9908),Z=r(507),C=r(9100),N=r(9657),U=r(1650),y=function(t){function e(){return t.apply(this,arguments)||this}(0,a.Z)(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!1,this.isDraggedOver=!1},r.view=function(){var t=this.attrs.user;return m("div",{className:(0,U.Z)(["AvatarEditor","Dropdown",this.attrs.className,this.loading&&"loading",this.isDraggedOver&&"dragover"])},(0,w.Z)(t),m("a",{className:t.avatarUrl()?"Dropdown-toggle":"Dropdown-toggle AvatarEditor--noAvatar",title:app.translator.trans("core.forum.user.avatar_upload_tooltip"),"data-toggle":"dropdown",onclick:this.quickUpload.bind(this),ondragover:this.enableDragover.bind(this),ondragenter:this.enableDragover.bind(this),ondragleave:this.disableDragover.bind(this),ondragend:this.disableDragover.bind(this),ondrop:this.dropUpload.bind(this)},this.loading?m(c.Z,null):t.avatarUrl()?(0,C.Z)("fas fa-pencil-alt"):(0,C.Z)("fas fa-plus-circle")),m("ul",{className:"Dropdown-menu Menu"},(0,h.Z)(this.controlItems().toArray())))},r.controlItems=function(){var t=new i.Z;return t.add("upload",m(u.Z,{icon:"fas fa-upload",onclick:this.openPicker.bind(this)},app.translator.trans("core.forum.user.avatar_upload_button"))),t.add("remove",m(u.Z,{icon:"fas fa-times",onclick:this.remove.bind(this)},app.translator.trans("core.forum.user.avatar_remove_button"))),t},r.enableDragover=function(t){t.preventDefault(),t.stopPropagation(),this.isDraggedOver=!0},r.disableDragover=function(t){t.preventDefault(),t.stopPropagation(),this.isDraggedOver=!1},r.dropUpload=function(t){t.preventDefault(),t.stopPropagation(),this.isDraggedOver=!1,this.upload(t.dataTransfer.files[0])},r.quickUpload=function(t){this.attrs.user.avatarUrl()||(t.preventDefault(),t.stopPropagation(),this.openPicker())},r.openPicker=function(){var t=this;this.loading||$('<input type="file">').appendTo("body").hide().click().on("input",(function(e){t.upload($(e.target)[0].files[0])}))},r.upload=function(t){if(!this.loading){var e=this.attrs.user,r=new FormData;r.append("avatar",t),this.loading=!0,m.redraw(),app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/users/"+e.id()+"/avatar",serialize:function(t){return t},body:r}).then(this.success.bind(this),this.failure.bind(this))}},r.remove=function(){var t=this.attrs.user;this.loading=!0,m.redraw(),app.request({method:"DELETE",url:app.forum.attribute("apiUrl")+"/users/"+t.id()+"/avatar"}).then(this.success.bind(this),this.failure.bind(this))},r.success=function(t){app.store.pushPayload(t),delete this.attrs.user.avatarColor,this.loading=!1,m.redraw()},r.failure=function(t){this.loading=!1,m.redraw()},e}(s.Z);window.flreg.add("components/AvatarEditor",y);var _=function(t){function e(){return t.apply(this,arguments)||this}(0,a.Z)(e,t);var r=e.prototype;return r.view=function(){var t=this.attrs.user,e=(new b).controls(t,this).toArray(),r=t.color(),a=t.badges().toArray();return m("div",{className:"UserCard "+(this.attrs.className||""),style:r?{backgroundColor:r}:""},m("div",{className:"darkenBackground"},m("div",{className:"container"},e.length?N.Z.component({className:"UserCard-controls App-primaryControl",menuClassName:"Dropdown-menu--right",buttonClassName:this.attrs.controlsButtonClassName,label:app.translator.trans("core.forum.user_controls.button"),accessibleToggleLabel:app.translator.trans("core.forum.user_controls.toggle_dropdown_accessible_label"),icon:"fas fa-ellipsis-v"},e):"",m("div",{className:"UserCard-profile"},m("h2",{className:"UserCard-identity"},this.attrs.editable?[y.component({user:t,className:"UserCard-avatar"}),(0,Z.Z)(t)]:m(n.Z,{href:app.route.user(t)},m("div",{className:"UserCard-avatar"},(0,w.Z)(t)),(0,Z.Z)(t))),a.length?m("ul",{className:"UserCard-badges badges"},(0,h.Z)(a)):"",m("ul",{className:"UserCard-info"},(0,h.Z)(this.infoItems().toArray()))))))},r.infoItems=function(){var t=new i.Z,e=this.attrs.user,r=e.lastSeenAt();if(r){var a=e.isOnline();t.add("lastSeen",m("span",{className:"UserCard-lastSeen"+(a?" online":"")},a?[(0,C.Z)("fas fa-circle")," ",app.translator.trans("core.forum.user.online_text")]:[(0,C.Z)("far fa-clock")," ",(0,o.Z)(r)]))}return t.add("joined",m("span",{className:"UserCard-joinedAt"},app.translator.trans("core.forum.user.joined_date_text",{ago:(0,o.Z)(e.joinTime())}))),t},e}(s.Z);function D(t){if(t.lastSeenAt()&&t.isOnline())return m("span",{className:"UserOnline"},(0,C.Z)("fas fa-circle"))}window.flreg.add("components/UserCard",_),window.flreg.add("helpers/userOnline",D);var A=function(t){function e(){return t.apply(this,arguments)||this}(0,a.Z)(e,t);var r=e.prototype;return r.view=function(){var t=this.attrs.post,e=t.user();if(!e)return m("div",{className:"PostUser"},m("h3",null,(0,w.Z)(e,{className:"PostUser-avatar"})," ",(0,Z.Z)(e)));var r="";return!t.isHidden()&&this.attrs.cardVisible&&(r=_.component({user:e,className:"UserCard--popover",controlsButtonClassName:"Button Button--icon Button--flat"})),m("div",{className:"PostUser"},m("h3",null,m(n.Z,{href:app.route.user(e)},(0,w.Z)(e,{className:"PostUser-avatar"}),D(e),(0,Z.Z)(e))),m("ul",{className:"PostUser-badges badges"},(0,h.Z)(e.badges().toArray())),r)},r.oncreate=function(e){var r,a=this;t.prototype.oncreate.call(this,e),this.$().on("mouseover","h3 a, .UserCard",(function(){clearTimeout(r),r=setTimeout(a.showCard.bind(a),500)})).on("mouseout","h3 a, .UserCard",(function(){clearTimeout(r),r=setTimeout(a.hideCard.bind(a),250)}))},r.showCard=function(){var t=this;this.attrs.oncardshow(),setTimeout((function(){return t.$(".UserCard").addClass("in")}))},r.hideCard=function(){var t=this;this.$(".UserCard").removeClass("in").one("transitionend webkitTransitionEnd oTransitionEnd",(function(){t.attrs.oncardhide()}))},e}(s.Z);window.flreg.add("components/PostUser",A)}}]);
//# sourceMappingURL=PostUser.js.map