(self.webpackChunkflarum_core=self.webpackChunkflarum_core||[]).push([[847],{5785:(s,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>v});var t=a(1788),o=a(6156),n=a(3340),r=a(7037),i=a(1698),c=a(2415),p=a(9499),l=a(6801),u=a(8777),d=a(5462),h=a(7971),f=a(6317),v=function(s){function e(){return s.apply(this,arguments)||this}(0,t.Z)(e,s);var o=e.prototype;return o.oninit=function(a){s.prototype.oninit.call(this,a),app.previous.matches(l.Z)&&(this.lastDiscussion=app.previous.get("discussion")),app.previous.matches(e)&&app.discussions.clear(),app.discussions.refreshParams(app.search.params()),app.history.push("index",app.translator.trans("core.forum.header.back_to_index_tooltip")),this.bodyClass="App--index",this.scrollTopOnCreate=!1},o.view=function(){return m("div",{className:"IndexPage"},this.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,(0,i.Z)(this.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},(0,i.Z)(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},(0,i.Z)(this.actionItems().toArray()))),m(c.Z,{state:app.discussions})))))},o.setTitle=function(){app.setTitle(app.translator.trans("core.forum.index.meta_title_text")),app.setTitleCount(0)},o.oncreate=function(e){s.prototype.oncreate.call(this,e),this.setTitle();var a=app.cache.heroHeight,t=app.cache.heroHeight=this.$(".Hero").outerHeight()||0,o=app.cache.scrollTop;if($("#app").css("min-height",$(window).height()+t),null!=app.previous.type&&("desktop"==app.screen()||"desktop-hd"==app.screen()||this.lastDiscussion?$(window).scrollTop(o-a+t):$(window).scrollTop(0),this.lastDiscussion)){var n=this.$('li[data-id="'+this.lastDiscussion.id()+'"] .DiscussionListItem');if(n.length){var r=$("#header").outerHeight(),i=$(window).height(),c=n.offset().top,p=c+n.outerHeight();(c<o+r||p>o+i)&&$(window).scrollTop(c-r)}}},o.onbeforeremove=function(){app.cache.scrollTop=$(window).scrollTop()},o.onremove=function(){s.prototype.onremove.call(this),$("#app").css("min-height","")},o.hero=function(){return p.Z.component()},o.sidebarItems=function(){var s=this,e=new r.Z,a=app.forum.attribute("canStartDiscussion")||!app.session.user;return e.add("newDiscussion",d.Z.component({icon:"fas fa-edit",className:"Button Button--primary IndexPage-newDiscussion",itemClassName:"App-primaryControl",onclick:function(){return s.newDiscussionAction().catch((function(){}))},disabled:!a},app.translator.trans(a?"core.forum.index.start_discussion_button":"core.forum.index.cannot_start_discussion_button"))),e.add("nav",f.Z.component({buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:app.translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems(this).toArray())),e},o.navItems=function(){var s=new r.Z,e=app.search.stickyParams();return s.add("allDiscussions",h.Z.component({href:app.route("index",e),icon:"far fa-comments"},app.translator.trans("core.forum.index.all_discussions_link")),100),s},o.viewItems=function(){var s=new r.Z,e=app.discussions.sortMap(),a={};for(var t in e)a[t]=app.translator.trans("core.forum.index_sort."+t+"_button");return s.add("sort",u.Z.component({buttonClassName:"Button",label:a[app.search.params().sort]||Object.keys(e).map((function(s){return a[s]}))[0],accessibleToggleLabel:app.translator.trans("core.forum.index_sort.toggle_dropdown_accessible_label")},Object.keys(a).map((function(s){var t=a[s],o=(app.search.params().sort||Object.keys(e)[0])===s;return d.Z.component({icon:!o||"fas fa-check",onclick:app.search.changeSort.bind(app.search,s),active:o},t)})))),s},o.actionItems=function(){var s=new r.Z;return s.add("refresh",d.Z.component({title:app.translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:function(){app.discussions.refresh(),app.session.user&&(app.store.find("users",app.session.user.id()),m.redraw())}})),app.session.user&&s.add("markAllAsRead",d.Z.component({title:app.translator.trans("core.forum.index.mark_all_as_read_tooltip"),icon:"fas fa-check",className:"Button Button--icon",onclick:this.markAllAsRead.bind(this)})),s},o.newDiscussionAction=function(){var s=function(){return a.e(460).then(a.bind(a,5127))},e=function(){return a.e(437).then(a.bind(a,2099))};return new Promise((function(a,t){return app.session.user?(app.composer.load(e,{user:app.session.user}),app.composer.show(),a(app.composer)):(app.modal.show(s),t())}))},o.markAllAsRead=function(){confirm(app.translator.trans("core.forum.index.mark_all_as_read_confirmation"))&&app.session.user.save({markedAllAsReadAt:new Date})},e}(n.Z);(0,o.Z)(v,"providesInitialSearch",!0)}}]);
//# sourceMappingURL=IndexPage.js.map