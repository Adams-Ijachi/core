(self.webpackChunk_flarum_core=self.webpackChunk_flarum_core||[]).push([[192,293],{763:(t,o,n)=>{"use strict";n.r(o),n.d(o,{default:()=>u});var e=n(1788),s=n(4810),r=n(2587),i=n(8046),a=n(9100);function c(t){app.composer.isFullScreen()&&(app.composer.minimize(),t.stopPropagation())}var u=function(t){function o(){return t.apply(this,arguments)||this}(0,e.Z)(o,t),o.initAttrs=function(o){t.initAttrs.call(this,o),o.submitLabel=o.submitLabel||app.translator.trans("core.forum.composer_edit.submit_button"),o.confirmExit=o.confirmExit||app.translator.trans("core.forum.composer_edit.discard_confirmation"),o.originalContent=o.originalContent||o.post.content(),o.user=o.user||o.post.user(),o.post.editedContent=o.originalContent};var n=o.prototype;return n.headerItems=function(){var o=t.prototype.headerItems.call(this),n=this.attrs.post;return o.add("title",m("h3",null,(0,a.Z)("fas fa-pencil-alt")," ",m(i.Z,{href:app.route.discussion(n.discussion(),n.number()),onclick:c},app.translator.trans("core.forum.composer_edit.post_link",{number:n.number(),discussion:n.discussion().title()})))),o},n.jumpToPreview=function(t){c(t),m.route.set(app.route.post(this.attrs.post))},n.data=function(){return{content:this.composer.fields.content()}},n.onsubmit=function(){var t=this,o=this.attrs.post.discussion();this.loading=!0;var n=this.data();this.attrs.post.save(n).then((function(n){if(app.viewingDiscussion(o))app.current.get("stream").goToNumber(n.number());else{var e,s=r.Z.component({className:"Button Button--link",onclick:function(){m.route.set(app.route.post(n)),app.alerts.dismiss(e)}},app.translator.trans("core.forum.composer_edit.view_button"));e=app.alerts.show({type:"success",controls:[s]},app.translator.trans("core.forum.composer_edit.edited_message"))}t.composer.hide()}),this.loaded.bind(this))},o}(s.Z);window.flreg.add("components/EditPostComposer",u)},5776:(t,o,n)=>{"use strict";n.r(o),n.d(o,{default:()=>h});var e=n(1788),s=n(8931),r=n(135),i=n(9657),a=n(763),c=n(2587),u=n(5128),p=n(4594),l=n(5731),d=function(){function t(){}var o=t.prototype;return o.controls=function(t,o){var n=this,e=new p.Z;return["user","moderation","destructive"].forEach((function(s){var r=n[s+"Controls"](t,o).toArray();r.length&&(r.forEach((function(t){return e.add(t.itemName,t)})),e.add(s+"Separator",u.Z.component()))})),e},o.userControls=function(t,o){return new p.Z},o.moderationControls=function(t,o){var n=new p.Z;return"comment"===t.contentType()&&t.canEdit()&&(t.isHidden()||n.add("edit",c.Z.component({icon:"fas fa-pencil-alt",onclick:this.editAction.bind(t)},app.translator.trans("core.forum.post_controls.edit_button")))),n},o.destructiveControls=function(t,o){var n=new p.Z;return"comment"!==t.contentType()||t.isHidden()?("comment"===t.contentType()&&t.canHide()&&n.add("restore",c.Z.component({icon:"fas fa-reply",onclick:this.restoreAction.bind(t)},app.translator.trans("core.forum.post_controls.restore_button"))),t.canDelete()&&n.add("delete",c.Z.component({icon:"fas fa-times",onclick:this.deleteAction.bind(t,o)},app.translator.trans("core.forum.post_controls.delete_forever_button")))):t.canHide()&&n.add("hide",c.Z.component({icon:"far fa-trash-alt",onclick:this.hideAction.bind(t)},app.translator.trans("core.forum.post_controls.delete_button"))),n},o.editAction=function(){var t=this;return new Promise((function(o){return app.composer.load(a.default,{post:t}),app.composer.show(),o()}))},o.hideAction=function(){if(confirm((0,l.Z)(app.translator.trans("core.forum.post_controls.hide_confirmation"))))return this.pushAttributes({hiddenAt:new Date,hiddenUser:app.session.user}),this.save({isHidden:!0}).then((function(){return m.redraw()}))},o.restoreAction=function(){return this.pushAttributes({hiddenAt:null,hiddenUser:null}),this.save({isHidden:!1}).then((function(){return m.redraw()}))},o.deleteAction=function(t){var o=this;if(confirm((0,l.Z)(app.translator.trans("core.forum.post_controls.delete_confirmation"))))return t&&(t.loading=!0),this.delete().then((function(){var t=o.discussion();t.removePost(o.id()),t.postIds().length||(app.discussions.removeDiscussion(t),app.viewingDiscussion(t)&&app.history.back())})).catch((function(){})).then((function(){t&&(t.loading=!1),m.redraw()}))},t}();window.flreg.add("utils/PostControls",d);var f=n(7473),h=function(t){function o(){return t.apply(this,arguments)||this}(0,e.Z)(o,t);var n=o.prototype;return n.oninit=function(o){var n=this;t.prototype.oninit.call(this,o),this.loading=!1,this.subtree=new r.Z((function(){return n.attrs.post.freshness}),(function(){var t=n.attrs.post.user();return t&&t.freshness}),(function(){return n.controlsOpen}))},n.view=function(){var t=this,o=this.elementAttrs();o.className=this.classes(o.className).join(" ");var n=(new d).controls(this.attrs.post,this).toArray();return m("article",o,m("div",null,this.content(),m("aside",{className:"Post-actions"},m("ul",null,(0,f.Z)(this.actionItems().toArray()),n.length?m("li",null,m(i.Z,{className:"Post-controls",buttonClassName:"Button Button--icon Button--flat",menuClassName:"Dropdown-menu--right",icon:"fas fa-ellipsis-h",onshow:function(){return t.$(".Post-actions").addClass("open")},onhide:function(){return t.$(".Post-actions").removeClass("open")},accessibleToggleLabel:app.translator.trans("core.forum.post_controls.toggle_dropdown_accessible_label")},n)):"")),m("footer",{className:"Post-footer"},m("ul",null,(0,f.Z)(this.footerItems().toArray())))))},n.onbeforeupdate=function(o){return t.prototype.onbeforeupdate.call(this,o),this.subtree.needsRebuild()},n.onupdate=function(){var t=this.$(".Post-actions"),o=this.$(".Post-controls");t.toggleClass("open",o.hasClass("open"))},n.elementAttrs=function(){return{}},n.content=function(){return[]},n.classes=function(t){var o=(t||"").split(" ").concat(["Post"]),n=this.attrs.post.user(),e=this.attrs.post.discussion();return this.loading&&o.push("Post--loading"),n&&n===app.session.user&&o.push("Post--by-actor"),n&&n===e.user()&&o.push("Post--by-start-user"),o},n.actionItems=function(){return new p.Z},n.footerItems=function(){return new p.Z},o}(s.Z);window.flreg.add("components/Post",h)}}]);
//# sourceMappingURL=Post.js.map