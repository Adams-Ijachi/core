{"version":3,"sources":["webpack://@flarum/core/./src/forum/components/LogInButtons.js","webpack://@flarum/core/./src/forum/components/SignUpModal.js"],"names":["LogInButtons","view","className","this","items","toArray","ItemList","Component","window","flreg","add","SignUpModal","oninit","vnode","username","Stream","attrs","email","password","title","app","translator","trans","content","body","footer","isProvided","field","provided","indexOf","token","fields","name","type","placeholder","extractText","bidi","disabled","loading","a","onclick","logIn","bind","identification","modal","show","onready","$","select","onsubmit","e","preventDefault","submitData","request","url","forum","attribute","method","errorHandler","onerror","then","location","reload","loaded","data","Modal"],"mappings":"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","file":"forum/components/SignUpModal.js","sourcesContent":["import Component from '../../common/Component';\nimport ItemList from '../../common/utils/ItemList';\n\n/**\n * The `LogInButtons` component displays a collection of social login buttons.\n */\nexport default class LogInButtons extends Component {\n  view() {\n    return <div className=\"LogInButtons\">{this.items().toArray()}</div>;\n  }\n\n  /**\n   * Build a list of LogInButton components.\n   *\n   * @return {ItemList}\n   * @public\n   */\n  items() {\n    return new ItemList();\n  }\n}\n\nwindow.flreg.add('components/LogInButtons', LogInButtons)","import Modal from '../../common/components/Modal';\nimport Button from '../../common/components/Button';\nimport LogInButtons from './LogInButtons';\nimport extractText from '../../common/utils/extractText';\nimport ItemList from '../../common/utils/ItemList';\nimport Stream from '../../common/utils/Stream';\n\n/**\n * The `SignUpModal` component displays a modal dialog with a singup form.\n *\n * ### Attrs\n *\n * - `username`\n * - `email`\n * - `password`\n * - `token` An email token to sign up with.\n */\nexport default class SignUpModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    /**\n     * The value of the username input.\n     *\n     * @type {Function}\n     */\n    this.username = Stream(this.attrs.username || '');\n\n    /**\n     * The value of the email input.\n     *\n     * @type {Function}\n     */\n    this.email = Stream(this.attrs.email || '');\n\n    /**\n     * The value of the password input.\n     *\n     * @type {Function}\n     */\n    this.password = Stream(this.attrs.password || '');\n  }\n\n  className() {\n    return 'Modal--small SignUpModal';\n  }\n\n  title() {\n    return app.translator.trans('core.forum.sign_up.title');\n  }\n\n  content() {\n    return [<div className=\"Modal-body\">{this.body()}</div>, <div className=\"Modal-footer\">{this.footer()}</div>];\n  }\n\n  isProvided(field) {\n    return this.attrs.provided && this.attrs.provided.indexOf(field) !== -1;\n  }\n\n  body() {\n    return [this.attrs.token ? '' : <LogInButtons />, <div className=\"Form Form--centered\">{this.fields().toArray()}</div>];\n  }\n\n  fields() {\n    const items = new ItemList();\n\n    items.add(\n      'username',\n      <div className=\"Form-group\">\n        <input\n          className=\"FormControl\"\n          name=\"username\"\n          type=\"text\"\n          placeholder={extractText(app.translator.trans('core.forum.sign_up.username_placeholder'))}\n          bidi={this.username}\n          disabled={this.loading || this.isProvided('username')}\n        />\n      </div>,\n      30\n    );\n\n    items.add(\n      'email',\n      <div className=\"Form-group\">\n        <input\n          className=\"FormControl\"\n          name=\"email\"\n          type=\"email\"\n          placeholder={extractText(app.translator.trans('core.forum.sign_up.email_placeholder'))}\n          bidi={this.email}\n          disabled={this.loading || this.isProvided('email')}\n        />\n      </div>,\n      20\n    );\n\n    if (!this.attrs.token) {\n      items.add(\n        'password',\n        <div className=\"Form-group\">\n          <input\n            className=\"FormControl\"\n            name=\"password\"\n            type=\"password\"\n            placeholder={extractText(app.translator.trans('core.forum.sign_up.password_placeholder'))}\n            bidi={this.password}\n            disabled={this.loading}\n          />\n        </div>,\n        10\n      );\n    }\n\n    items.add(\n      'submit',\n      <div className=\"Form-group\">\n        <Button className=\"Button Button--primary Button--block\" type=\"submit\" loading={this.loading}>\n          {app.translator.trans('core.forum.sign_up.submit_button')}\n        </Button>\n      </div>,\n      -10\n    );\n\n    return items;\n  }\n\n  footer() {\n    return [\n      <p className=\"SignUpModal-logIn\">{app.translator.trans('core.forum.sign_up.log_in_text', { a: <a onclick={this.logIn.bind(this)} /> })}</p>,\n    ];\n  }\n\n  /**\n   * Open the log in modal, prefilling it with an email/username/password if\n   * the user has entered one.\n   *\n   * @public\n   */\n  logIn() {\n    const LogInModal = () => import(/* webpackChunkName: \"forum/components/LogInModal\" */ './LogInModal');\n\n    const attrs = {\n      identification: this.email() || this.username(),\n      password: this.password(),\n    };\n\n    app.modal.show(LogInModal, attrs);\n  }\n\n  onready() {\n    if (this.attrs.username && !this.attrs.email) {\n      this.$('[name=email]').select();\n    } else {\n      this.$('[name=username]').select();\n    }\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    this.loading = true;\n\n    const body = this.submitData();\n\n    app\n      .request({\n        url: app.forum.attribute('baseUrl') + '/register',\n        method: 'POST',\n        body,\n        errorHandler: this.onerror.bind(this),\n      })\n      .then(() => window.location.reload(), this.loaded.bind(this));\n  }\n\n  /**\n   * Get the data that should be submitted in the sign-up request.\n   *\n   * @return {Object}\n   * @protected\n   */\n  submitData() {\n    const data = {\n      username: this.username(),\n      email: this.email(),\n    };\n\n    if (this.attrs.token) {\n      data.token = this.attrs.token;\n    } else {\n      data.password = this.password();\n    }\n\n    return data;\n  }\n}\n\nwindow.flreg.add('components/SignUpModal', SignUpModal)"],"sourceRoot":""}