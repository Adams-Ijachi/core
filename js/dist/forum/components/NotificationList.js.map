{"version":3,"sources":["webpack://@flarum/core/./src/forum/components/Notification.js","webpack://@flarum/core/./src/forum/components/DiscussionRenamedNotification.js","webpack://@flarum/core/./src/forum/components/NotificationList.js"],"names":["Notification","view","notification","this","attrs","href","Link","className","contentType","isRead","external","includes","onclick","markAsRead","bind","Button","icon","title","app","translator","trans","e","preventDefault","stopPropagation","avatar","fromUser","content","humanTime","createdAt","excerpt","session","user","pushAttributes","unreadNotificationCount","save","Component","window","flreg","add","DiscussionRenamedNotification","route","discussion","subject","postNumber","NotificationList","state","pages","getNotificationPages","markAllAsRead","length","map","notifications","groups","discussions","forEach","Discussion","key","id","push","indexOf","group","badges","toArray","listItems","forum","attribute","NotificationComponent","notificationComponents","component","isLoading","LoadingIndicator","discussionRenamed","oncreate","vnode","$notifications","$","$scrollParent","inPanel","boundScrollHandler","scrollHandler","on","onremove","off","scrollParent","document","documentElement","atBottom","Math","abs","scrollHeight","scrollTop","clientHeight","hasMoreResults","loadMore","css"],"mappings":"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","file":"forum/components/NotificationList.js","sourcesContent":["import Component from '../../common/Component';\nimport avatar from '../../common/helpers/avatar';\nimport icon from '../../common/helpers/icon';\nimport humanTime from '../../common/helpers/humanTime';\nimport Button from '../../common/components/Button';\nimport Link from '../../common/components/Link';\n\n/**\n * The `Notification` component abstract displays a single notification.\n * Subclasses should implement the `icon`, `href`, and `content` methods.\n *\n * ### Attrs\n *\n * - `notification`\n *\n * @abstract\n */\nexport default class Notification extends Component {\n  view() {\n    const notification = this.attrs.notification;\n    const href = this.href();\n\n    return (\n      <Link\n        className={'Notification Notification--' + notification.contentType() + ' ' + (!notification.isRead() ? 'unread' : '')}\n        href={href}\n        external={href.includes('://')}\n        onclick={this.markAsRead.bind(this)}\n      >\n        {!notification.isRead() &&\n          Button.component({\n            className: 'Notification-action Button Button--icon Button--link',\n            icon: 'fas fa-check',\n            title: app.translator.trans('core.forum.notifications.mark_as_read_tooltip'),\n            onclick: (e) => {\n              e.preventDefault();\n              e.stopPropagation();\n\n              this.markAsRead();\n            },\n          })}\n        {avatar(notification.fromUser())}\n        {icon(this.icon(), { className: 'Notification-icon' })}\n        <span className=\"Notification-content\">{this.content()}</span>\n        {humanTime(notification.createdAt())}\n        <div className=\"Notification-excerpt\">{this.excerpt()}</div>\n      </Link>\n    );\n  }\n\n  /**\n   * Get the name of the icon that should be displayed in the notification.\n   *\n   * @return {String}\n   * @abstract\n   */\n  icon() {}\n\n  /**\n   * Get the URL that the notification should link to.\n   *\n   * @return {String}\n   * @abstract\n   */\n  href() {}\n\n  /**\n   * Get the content of the notification.\n   *\n   * @return {VirtualElement}\n   * @abstract\n   */\n  content() {}\n\n  /**\n   * Get the excerpt of the notification.\n   *\n   * @return {VirtualElement}\n   * @abstract\n   */\n  excerpt() {}\n\n  /**\n   * Mark the notification as read.\n   */\n  markAsRead() {\n    if (this.attrs.notification.isRead()) return;\n\n    app.session.user.pushAttributes({ unreadNotificationCount: app.session.user.unreadNotificationCount() - 1 });\n\n    this.attrs.notification.save({ isRead: true });\n  }\n}\n\nwindow.flreg.add('components/Notification', Notification)","import Notification from './Notification';\n\n/**\n * The `DiscussionRenamedNotification` component displays a notification which\n * indicates that a discussion has had its title changed.\n *\n * ### Attrs\n *\n * - All of the attrs for Notification\n */\nexport default class DiscussionRenamedNotification extends Notification {\n  icon() {\n    return 'fas fa-pencil-alt';\n  }\n\n  href() {\n    const notification = this.attrs.notification;\n\n    return app.route.discussion(notification.subject(), notification.content().postNumber);\n  }\n\n  content() {\n    return app.translator.trans('core.forum.notifications.discussion_renamed_text', { user: this.attrs.notification.fromUser() });\n  }\n}\n\nwindow.flreg.add('components/DiscussionRenamedNotification', DiscussionRenamedNotification)","import Component from '../../common/Component';\nimport listItems from '../../common/helpers/listItems';\nimport Button from '../../common/components/Button';\nimport Link from '../../common/components/Link';\nimport LoadingIndicator from '../../common/components/LoadingIndicator';\nimport Discussion from '../../common/models/Discussion';\nimport DiscussionRenamedNotification from './DiscussionRenamedNotification';\n\n/**\n * The `NotificationList` component displays a list of the logged-in user's\n * notifications, grouped by discussion.\n */\nexport default class NotificationList extends Component {\n  view() {\n    const state = this.attrs.state;\n    const pages = state.getNotificationPages();\n\n    return (\n      <div className=\"NotificationList\">\n        <div className=\"NotificationList-header\">\n          <div className=\"App-primaryControl\">\n            {Button.component({\n              className: 'Button Button--icon Button--link',\n              icon: 'fas fa-check',\n              title: app.translator.trans('core.forum.notifications.mark_all_as_read_tooltip'),\n              onclick: state.markAllAsRead.bind(state),\n            })}\n          </div>\n\n          <h4 className=\"App-titleControl App-titleControl--text\">{app.translator.trans('core.forum.notifications.title')}</h4>\n        </div>\n\n        <div className=\"NotificationList-content\">\n          {pages.length\n            ? pages.map((notifications) => {\n                const groups = [];\n                const discussions = {};\n\n                notifications.forEach((notification) => {\n                  const subject = notification.subject();\n\n                  if (typeof subject === 'undefined') return;\n\n                  // Get the discussion that this notification is related to. If it's not\n                  // directly related to a discussion, it may be related to a post or\n                  // other entity which is related to a discussion.\n                  let discussion = false;\n                  if (subject instanceof Discussion) discussion = subject;\n                  else if (subject && subject.discussion) discussion = subject.discussion();\n\n                  // If the notification is not related to a discussion directly or\n                  // indirectly, then we will assign it to a neutral group.\n                  const key = discussion ? discussion.id() : 0;\n                  discussions[key] = discussions[key] || { discussion: discussion, notifications: [] };\n                  discussions[key].notifications.push(notification);\n\n                  if (groups.indexOf(discussions[key]) === -1) {\n                    groups.push(discussions[key]);\n                  }\n                });\n\n                return groups.map((group) => {\n                  const badges = group.discussion && group.discussion.badges().toArray();\n\n                  return (\n                    <div className=\"NotificationGroup\">\n                      {group.discussion ? (\n                        <Link className=\"NotificationGroup-header\" href={app.route.discussion(group.discussion)}>\n                          {badges && badges.length ? <ul className=\"NotificationGroup-badges badges\">{listItems(badges)}</ul> : ''}\n                          {group.discussion.title()}\n                        </Link>\n                      ) : (\n                        <div className=\"NotificationGroup-header\">{app.forum.attribute('title')}</div>\n                      )}\n\n                      <ul className=\"NotificationGroup-content\">\n                        {group.notifications.map((notification) => {\n                          const NotificationComponent = this.notificationComponents()[notification.contentType()];\n                          return NotificationComponent ? <li>{NotificationComponent.component({ notification })}</li> : '';\n                        })}\n                      </ul>\n                    </div>\n                  );\n                });\n              })\n            : ''}\n          {state.isLoading() ? (\n            <LoadingIndicator className=\"LoadingIndicator--block\" />\n          ) : pages.length ? (\n            ''\n          ) : (\n            <div className=\"NotificationList-empty\">{app.translator.trans('core.forum.notifications.empty_text')}</div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * A map of notification types to their components.\n   *\n   * @type {Object}\n   */\n  notificationComponents() {\n    return {\n      discussionRenamed: DiscussionRenamedNotification,\n    };\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    this.$notifications = this.$('.NotificationList-content');\n\n    // If we are on the notifications page, the window will be scrolling and not the $notifications element.\n    this.$scrollParent = this.inPanel() ? this.$notifications : $(window);\n\n    this.boundScrollHandler = this.scrollHandler.bind(this);\n    this.$scrollParent.on('scroll', this.boundScrollHandler);\n  }\n\n  onremove() {\n    this.$scrollParent.off('scroll', this.boundScrollHandler);\n  }\n\n  scrollHandler() {\n    const state = this.attrs.state;\n\n    // Whole-page scroll events are listened to on `window`, but we need to get the actual\n    // scrollHeight, scrollTop, and clientHeight from the document element.\n    const scrollParent = this.inPanel() ? this.$scrollParent[0] : document.documentElement;\n\n    // On very short screens, the scrollHeight + scrollTop might not reach the clientHeight\n    // by a fraction of a pixel, so we compensate for that.\n    const atBottom = Math.abs(scrollParent.scrollHeight - scrollParent.scrollTop - scrollParent.clientHeight) <= 1;\n\n    if (state.hasMoreResults() && !state.isLoading() && atBottom) {\n      state.loadMore();\n    }\n  }\n\n  /**\n   * If the NotificationList component isn't in a panel (e.g. on NotificationPage when mobile),\n   * we need to listen to scroll events on the window, and get scroll state from the body.\n   */\n  inPanel() {\n    return this.$notifications.css('overflow') === 'auto';\n  }\n}\n\nwindow.flreg.add('components/NotificationList', NotificationList)"],"sourceRoot":""}