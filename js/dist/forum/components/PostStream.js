(self.webpackChunk_flarum_core=self.webpackChunk_flarum_core||[]).push([[563],{6392:(t,e,s)=>{s.a(t,(async t=>{s.d(e,{Z:()=>h});var o=s(1788),n=s(1650),i=s(6167),a=s(684),r=s(4594),c=s(7473),d=s(2587),l=s(9806),u=(await s.e(192).then(s.bind(s,5776))).default,p=await s.e(779).then(s.bind(s,6848)),h=function(t){function e(){return t.apply(this,arguments)||this}(0,o.Z)(e,t);var u=e.prototype;return u.oninit=function(e){var s=this;t.prototype.oninit.call(this,e),this.revealContent=!1,this.cardVisible=!1,this.subtree.check((function(){return s.cardVisible}),(function(){return s.isEditing()}),(function(){return s.revealContent}))},u.content=function(){return t.prototype.content.call(this).concat([m("header",{className:"Post-header"},m("ul",null,(0,c.Z)(this.headerItems().toArray()))),m("div",{className:"Post-body"},this.isEditing()?m(l.Z,{className:"Post-preview",composer:app.composer}):m.trust(this.attrs.post.contentHtml()))])},u.refreshContent=function(){var t=this.isEditing()?"":this.attrs.post.contentHtml();this.contentHtml!==t&&this.$(".Post-body script").each((function(){var t=document.createElement("script");t.textContent=this.textContent,Array.from(this.attributes).forEach((function(e){return t.setAttribute(e.name,e.value)})),this.parentNode.replaceChild(t,this)})),this.contentHtml=t},u.oncreate=function(e){t.prototype.oncreate.call(this,e),this.refreshContent()},u.onupdate=function(e){t.prototype.onupdate.call(this,e),this.refreshContent()},u.isEditing=function(){var t=this;s.e(293).then(s.bind(s,763)).then((function(e){return app.composer.bodyMatches(e.default,{post:t.attrs.post})}))},u.elementAttrs=function(){var e=this.attrs.post,s=t.prototype.elementAttrs.call(this);return s.className=(s.className||"")+" "+(0,n.Z)({CommentPost:!0,"Post--hidden":e.isHidden(),"Post--edited":e.isEdited(),revealContent:this.revealContent,editing:this.isEditing()}),s},u.toggleContent=function(){this.revealContent=!this.revealContent},u.headerItems=function(){var t=this,e=new r.Z,s=this.attrs.post;return e.add("user",p.default.component({post:s,cardVisible:this.cardVisible,oncardshow:function(){t.cardVisible=!0,m.redraw()},oncardhide:function(){t.cardVisible=!1,m.redraw()}}),100),e.add("meta",i.Z.component({post:s})),s.isEdited()&&!s.isHidden()&&e.add("edited",a.Z.component({post:s})),s.isHidden()&&e.add("toggle",d.Z.component({className:"Button Button--default Button--more",icon:"fas fa-ellipsis-h",onclick:this.toggleContent.bind(this)})),e},e}(u);window.flreg.add("components/CommentPost",h),t()}),1)},9806:(t,e,s)=>{s.d(e,{Z:()=>n});var o=s(1788),n=function(t){function e(){return t.apply(this,arguments)||this}(0,o.Z)(e,t),e.initAttrs=function(t){t.className=t.className||"",t.surround=t.surround||function(t){return t()}};var s=e.prototype;return s.view=function(){return m("div",{className:this.attrs.className})},s.oncreate=function(e){var s,o=this;t.prototype.oncreate.call(this,e);var n=function(){if(o.attrs.composer.isVisible()){var t=o.attrs.composer.fields.content();s!==t&&(s=t,o.attrs.surround((function(){return s9e.TextFormatter.preview(s||"",e.dom)})))}};n(),this.updateInterval=setInterval(n,50)},s.onremove=function(){clearInterval(this.updateInterval)},e}(s(8931).Z);window.flreg.add("components/ComposerPostPreview",n)},293:(t,e,s)=>{s.a(t,(async t=>{s.d(e,{Z:()=>r});var o=s(1788),n=s(7428),i=s(5731),a=t([n]),r=function(t){function e(){return t.apply(this,arguments)||this}(0,o.Z)(e,t);var s=e.prototype;return s.icon=function(){return"fas fa-pencil-alt"},s.description=function(t){var e=app.translator.trans("core.forum.post_stream.discussion_renamed_text",t),s=app.translator.trans("core.forum.post_stream.discussion_renamed_old_tooltip",t);return m("span",{title:(0,i.Z)(s)},e)},s.descriptionData=function(){var t=this.attrs.post,e=t.content()[0],s=t.content()[1];return{old:e,new:m("strong",{className:"DiscussionRenamedPost-new"},s)}},e}((n=(a.then?await a:a)[0]).Z);window.flreg.add("components/DiscussionRenamedPost",r)}))},7428:(t,e,s)=>{s.a(t,(async t=>{s.d(e,{Z:()=>d});var o=s(2122),n=s(1788),i=s(1666),a=s(507),r=s(9100),c=s(8046),d=function(t){function e(){return t.apply(this,arguments)||this}(0,n.Z)(e,t);var s=e.prototype;return s.elementAttrs=function(){var e=t.prototype.elementAttrs.call(this);return e.className=(e.className||"")+" EventPost "+(0,i.Ps)(this.attrs.post.contentType())+"Post",e},s.content=function(){var e=this.attrs.post.user(),s=(0,a.Z)(e),n=(0,o.Z)(this.descriptionData(),{user:e,username:e?m(c.Z,{className:"EventPost-user",href:app.route.user(e)},s):s});return t.prototype.content.call(this).concat([(0,r.Z)(this.icon(),{className:"EventPost-icon"}),m("div",{class:"EventPost-info"},this.description(n))])},s.icon=function(){return""},s.description=function(t){return app.translator.transChoice(this.descriptionKey(),t.count,t)},s.descriptionKey=function(){return""},s.descriptionData=function(){return{}},e}((await s.e(192).then(s.bind(s,5776))).default);window.flreg.add("components/EventPost",d),t()}),1)},2717:(t,e,s)=>{s.d(e,{Z:()=>a});var o=s(1788),n=s(8931),i=s(9908),a=function(t){function e(){return t.apply(this,arguments)||this}return(0,o.Z)(e,t),e.prototype.view=function(){return m("div",{className:"Post CommentPost LoadingPost"},m("header",{className:"Post-header"},(0,i.Z)(null,{className:"PostUser-avatar"}),m("div",{className:"fakeText"})),m("div",{className:"Post-body"},m("div",{className:"fakeText"}),m("div",{className:"fakeText"}),m("div",{className:"fakeText"})))},e}(n.Z);window.flreg.add("components/LoadingPost",a)},684:(t,e,s)=>{s.d(e,{Z:()=>r});var o=s(1788),n=s(8931),i=s(9052),a=s(5731),r=function(t){function e(){return t.apply(this,arguments)||this}(0,o.Z)(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e),this.shouldUpdateTooltip=!1,this.oldEditedInfo=null},s.view=function(){var t=this.attrs.post,e=t.editedUser(),s=(0,a.Z)(app.translator.trans("core.forum.post.edited_tooltip",{user:e,ago:(0,i.Z)(t.editedAt())}));return s!==this.oldEditedInfo&&(this.shouldUpdateTooltip=!0,this.oldEditedInfo=s),m("span",{className:"PostEdited",title:s},app.translator.trans("core.forum.post.edited_text"))},s.oncreate=function(e){t.prototype.oncreate.call(this,e),this.rebuildTooltip()},s.onupdate=function(){this.rebuildTooltip()},s.rebuildTooltip=function(){this.shouldUpdateTooltip&&(this.$().tooltip("destroy").tooltip(),this.shouldUpdateTooltip=!1)},e}(n.Z);window.flreg.add("components/PostEdited",r)},6167:(t,e,s)=>{s.d(e,{Z:()=>r});var o=s(1788),n=s(8931),i=s(6961),a=s(8966),r=function(t){function e(){return t.apply(this,arguments)||this}(0,o.Z)(e,t);var s=e.prototype;return s.view=function(){var t=this.attrs.post,e=t.createdAt(),s=this.getPermalink(t),o="ontouchstart"in document.documentElement;return m("div",{className:"Dropdown PostMeta"},m("a",{className:"Dropdown-toggle",onclick:function(t){var e=this;setTimeout((function(){return $(e).parent().find(".PostMeta-permalink").select()})),t.redraw=!1},"data-toggle":"dropdown"},(0,i.Z)(e)),m("div",{className:"Dropdown-menu dropdown-menu"},m("span",{className:"PostMeta-number"},app.translator.trans("core.forum.post.number_tooltip",{number:t.number()}))," ",m("span",{className:"PostMeta-time"},(0,a.Z)(e))," ",m("span",{className:"PostMeta-ip"},t.data.attributes.ipAddress),o?m("a",{className:"Button PostMeta-permalink",href:s},s):m("input",{className:"FormControl PostMeta-permalink",value:s,onclick:function(t){return t.stopPropagation()}})))},s.getPermalink=function(t){return window.location.origin+app.route.post(t)},e}(n.Z);window.flreg.add("components/PostMeta",r)},4371:(t,e,s)=>{s.a(t,(async t=>{s.r(e),s.d(e,{default:()=>h});var o=s(2122),n=s(1788),i=s(8931),a=s(8e3),r=s(2717),c=s(7374),d=s(2587),l=s(6392),u=s(293),p=t([u,l]);[u,l]=p.then?await p:p;var h=function(t){function e(){return t.apply(this,arguments)||this}(0,n.Z)(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e),this.discussion=this.attrs.discussion,this.stream=this.attrs.stream,this.scrollListener=new a.Z(this.onscroll.bind(this))},s.postComponents=function(){return{comment:l.Z,discussionRenamed:u.Z}},s.view=function(){var t,e=this,s=this.stream.viewingEnd(),n=this.stream.posts(),i=this.discussion.postIds(),a=function(t){$(t.dom).addClass("fadeIn"),setTimeout((function(){return $(t.dom).removeClass("fadeIn")}),500)},l=n.map((function(s,n){var c,d={"data-index":e.stream.visibleStart+n};if(s){var l=s.createdAt(),u=e.postComponents()[s.contentType()];c=u?u.component({post:s}):"",d.key="post"+s.id(),d.oncreate=a,d["data-time"]=l.toISOString(),d["data-number"]=s.number(),d["data-id"]=s.id(),d["data-type"]=s.contentType();var p=l-t;p>3456e5&&(c=[m("div",{className:"PostStream-timeGap"},m("span",null,app.translator.trans("core.forum.post_stream.time_lapsed_text",{period:dayjs().add(p,"ms").fromNow(!0)}))),c]),t=l}else d.key="post"+i[e.stream.visibleStart+n],c=r.Z.component();return m("div",(0,o.Z)({className:"PostStream-item"},d),c)}));return!s&&n[this.stream.visibleEnd-this.stream.visibleStart-1]&&l.push(m("div",{className:"PostStream-loadMore",key:"loadMore"},m(d.Z,{className:"Button",onclick:this.stream.loadNext.bind(this.stream)},app.translator.trans("core.forum.post_stream.load_more_button")))),!s||app.session.user&&!this.discussion.canReply()||l.push(m("div",{className:"PostStream-item",key:"reply","data-index":this.stream.count(),oncreate:a},c.Z.component({discussion:this.discussion}))),m("div",{className:"PostStream"},l)},s.onupdate=function(){this.triggerScroll()},s.oncreate=function(e){var s=this;t.prototype.oncreate.call(this,e),this.triggerScroll(),setTimeout((function(){return s.scrollListener.start()}))},s.onremove=function(){this.scrollListener.stop(),clearTimeout(this.calculatePositionTimeout)},s.triggerScroll=function(){if(this.stream.needsScroll){var t=this.stream.targetPost;this.stream.needsScroll=!1,"number"in t?this.scrollToNumber(t.number,this.stream.animateScroll):"index"in t&&this.scrollToIndex(t.index,this.stream.animateScroll,t.reply)}},s.onscroll=function(t){void 0===t&&(t=window.pageYOffset),this.stream.paused||this.stream.pagesLoading||(this.updateScrubber(t),this.loadPostsIfNeeded(t),clearTimeout(this.calculatePositionTimeout),this.calculatePositionTimeout=setTimeout(this.calculatePosition.bind(this,t),100))},s.loadPostsIfNeeded=function(t){void 0===t&&(t=window.pageYOffset);var e=this.getMarginTop(),s=$(window).height()-e,o=t+e;if(this.stream.visibleStart>0){var n=this.$(".PostStream-item[data-index="+this.stream.visibleStart+"]");n.length&&n.offset().top>o-300&&this.stream.loadPrevious()}if(this.stream.visibleEnd<this.stream.count()){var i=this.$(".PostStream-item[data-index="+(this.stream.visibleEnd-1)+"]");i.length&&i.offset().top+i.outerHeight(!0)<o+s+300&&this.stream.loadNext()}},s.updateScrubber=function(t){void 0===t&&(t=window.pageYOffset);var e=this.getMarginTop(),s=$(window).height()-e,o=t+e,n=this.$(".PostStream-item[data-index]"),i=0,a="",r=null;n.each((function(){var t=$(this),e=t.offset().top,n=t.outerHeight(!0);if(e+n<o)return!0;if(e>o+s)return!1;var c=Math.max(0,o-e),d=Math.min(n,o+s-e)-c;null===r&&(r=parseFloat(t.data("index"))+c/n),d>0&&(i+=d/n);var l=t.data("time");l&&(a=l)})),this.stream.index=null!==r?r+1:this.stream.count(),this.stream.visible=i,a&&(this.stream.description=dayjs(a).format("MMMM YYYY"))},s.calculatePosition=function(t){void 0===t&&(t=window.pageYOffset);var e,s,o=this.getMarginTop(),n=$(window),i=n.height()-o,a=n.scrollTop()+o,r=t+o;this.$(".PostStream-item").each((function(){var t=$(this),o=t.offset().top,n=t.outerHeight(!0),c=Math.max(0,r-o);if(void 0===e&&(c/n<.75||(n-c)/i>.25)&&(e=t.data("number")),o+n>a){if(!(o+n<a+i))return!1;t.data("number")&&(s=t.data("number"))}})),e&&this.attrs.onPositionChange(e||1,s,e)},s.getMarginTop=function(){var t="phone"===app.screen()?"#app-navigation":"#header";return this.$()&&$(t).outerHeight()+parseInt(this.$().css("margin-top"),10)},s.scrollToNumber=function(t,e){var s=this.$(".PostStream-item[data-number="+t+"]");return this.scrollToItem(s,e).then(this.flashItem.bind(this,s))},s.scrollToIndex=function(t,e,s){var o=s?$(".PostStream-item:last-child"):this.$(".PostStream-item[data-index="+t+"]");this.scrollToItem(o,e,!0,s),s&&this.flashItem(o)},s.scrollToItem=function(t,e,s,o){var n=this,i=$("html, body").stop(!0),a=t.data("index");if(t.length){var r=t.offset().top-this.getMarginTop(),c=t.offset().top+t.height(),d=$(document).scrollTop(),l=d+$(window).height();if(s||r<d||c>l){var u=o?c-$(window).height()+app.composer.computedHeight():t.is(":first-child")?0:r;e?u!==d&&i.animate({scrollTop:u},"fast"):i.scrollTop(u)}}var p=function(){n.updateScrubber(),void 0!==a&&(n.stream.index=a+1)};return p(),this.stream.forceUpdateScrubber=!0,Promise.all([i.promise(),this.stream.loadPromise]).then((function(){var t;if(m.redraw.sync(),o){var e=$(".PostStream-item:last-child");$(window).scrollTop(e.offset().top+e.height()-$(window).height()+app.composer.computedHeight())}else 0===a?$(window).scrollTop(0):(t=$(".PostStream-item[data-index="+a+"]").offset())&&$(window).scrollTop(t.top-n.getMarginTop());p(),n.calculatePosition(),n.stream.paused=!1,n.loadPostsIfNeeded()}))},s.flashItem=function(t){t.removeClass("fadeIn"),t.addClass("flash").on("animationend webkitAnimationEnd",(function(e){t.removeClass("flash")}))},e}(i.Z);window.flreg.add("components/PostStream",h)}))},7374:(t,e,s)=>{s.d(e,{Z:()=>l});var o=s(1788),n=s(8931),i=s(9908),a=s(507),r=s(6102),c=s(9806),d=s(7473),l=function(t){function e(){return t.apply(this,arguments)||this}(0,o.Z)(e,t);var s=e.prototype;return s.view=function(){var t=this;if(app.composer.composingReplyTo(this.attrs.discussion))return m("article",{className:"Post CommentPost editing"},m("header",{className:"Post-header"},m("div",{className:"PostUser"},m("h3",null,(0,i.Z)(app.session.user,{className:"PostUser-avatar"}),(0,a.Z)(app.session.user)),m("ul",{className:"PostUser-badges badges"},(0,d.Z)(app.session.user.badges().toArray())))),m(c.Z,{className:"Post-body",composer:app.composer,surround:this.anchorPreview.bind(this)}));return m("article",{className:"Post ReplyPlaceholder",onclick:function(){r.Z.replyAction.call(t.attrs.discussion,!0).catch((function(){}))}},m("header",{className:"Post-header"},(0,i.Z)(app.session.user,{className:"PostUser-avatar"})," ",app.translator.trans("core.forum.post_stream.reply_placeholder")))},s.anchorPreview=function(t){var e=$(window).scrollTop()+$(window).height()>=$(document).height();t(),e&&$(window).scrollTop($(document).height())},e}(n.Z);window.flreg.add("components/ReplyPlaceholder",l)}}]);
//# sourceMappingURL=PostStream.js.map